<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		Harbor镜像仓库集群部署文档 | 
	 
	SREMC
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.sogo.com/web?query=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "sremc.github.io";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.4.14/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3efe99c287df5a1d6f0d02d187e403c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
    <a id="title" href="/" class="logo">SREMC</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">About</a>
		</li>
	
		<li class="menu-item">
			<a href="/tags" class="menu-item-link">Tags</a>
		</li>
	

	
		<li class="menu-item">
			<a href="/categories" class="menu-item-link">Categories</a>
		</li>
	

		<li class="menu-item">
			<a href="https://github.com/sremc" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										DNS
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/05/23/DNS/DNSmasq/">
                     
										    DNSmasq
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/12/02/DNS/DNS%E5%8F%8D%E8%A7%A3%E9%85%8D%E7%BD%AE/">
                     
										    DNS反解配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/12/DNS/DNS%E6%A6%82%E5%BF%B5/">
                     
										    DNS概念
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Go
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/12/04/Go/Golang-Gin%E4%B8%AD%E9%97%B4%E4%BB%B6/">
                     
										    Golang-Gin中间件
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/09/05/Go/Golang-beego/">
                     
										    Golang-beego
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/20/Go/Golang-json%E8%A7%A3%E6%9E%90/">
                     
										    Golang-json解析
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/01/21/Go/Golang-sync%E5%8C%85/">
                     
										    Golang-sync包
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/09/07/Go/Golang-%E5%8D%8F%E7%A8%8Bgoroutine/">
                     
										    Golang-协程goroutine
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/23/Go/Golang-%E5%9F%BA%E6%9C%AC%E5%B8%B8%E7%94%A8%E6%B1%87%E6%80%BB/">
                     
										    Golang-基本常用汇总
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/10/23/Go/Golang-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">
                     
										    Golang-基本数据类型
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/06/01/Go/Golang-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/">
                     
										    Golang-并发控制
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/09/07/Go/Golang-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">
                     
										    Golang-文件操作
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/09/05/Go/golang-gorm%E6%A1%86%E6%9E%B6/">
                     
										    golang-gorm框架
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										HTTP
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/09/07/HTTP/1RBAC-%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E6%9D%83%E9%99%90%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/">
                     
										    1RBAC-基于角色的权限访问控制
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2015/12/21/HTTP/3%E7%A7%8Dweb%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86%E7%9A%84%E6%96%B9%E5%BC%8F/">
                     
										    3种web会话管理的方式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/07/06/HTTP/%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E7%9A%84HTTP%E5%93%8D%E5%BA%94%E5%A4%B4/">
                     
										    一些安全相关的HTTP响应头
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/07/HTTP/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E5%BA%94%E8%AF%A5%E5%B0%BD%E5%BF%AB%E5%8D%87%E7%BA%A7%E5%88%B0HTTPS%EF%BC%9F/">
                     
										    为什么我们应该尽快升级到HTTPS？
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/07/HTTP/%E4%BB%8ENginx%E9%BB%98%E8%AE%A4%E4%B8%8D%E5%8E%8B%E7%BC%A9HTTP-1.0%E8%AF%B4%E8%B5%B7/">
                     
										    从Nginx默认不压缩HTTP-1.0说起
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/02/HTTP/%E7%90%86%E8%A7%A3HTTP%E5%B9%82%E7%AD%89%E6%80%A7/">
                     
										    理解HTTP幂等性
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Java
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/11/09/Java/JAVA_Tips/">
                     
										    JAVA_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/12/Java/JavaScript_Tips/">
                     
										    JavaScript_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/07/Java/JavaScript%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE%E9%97%AE%E9%A2%98/">
                     
										    JavaScript跨域访问问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/28/Java/Java%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">
                     
										    Java内存管理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/12/04/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
                     
										    Java多线程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/03/25/Java/java%E8%BF%9B%E7%A8%8B%E5%B7%A5%E5%85%B7/">
                     
										    java进程工具
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/01/Java/tomcat-servlet-demo/">
                     
										    tomcat-servlet-demo
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										K8S
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/01/26/K8S/CMD%E4%B8%8EENTRYPOINT%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB/">
                     
										    CMD与ENTRYPOINT主要区别
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2019/02/24/K8S/Harbor%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">
                     
										    Harbor镜像仓库集群部署文档
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/24/K8S/K8S-%E9%83%A8%E7%BD%B2/">
                     
										    K8S-部署
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/05/K8S/K8S-%E9%85%8D%E7%BD%AE/">
                     
										    K8S-配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/05/25/K8S/docker%E7%9B%B8%E5%85%B3/">
                     
										    docker相关
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/01/K8S/k8s-pause%E5%AE%B9%E5%99%A8/">
                     
										    k8s-pause容器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/11/01/K8S/k8s-%E6%8E%92%E9%94%99/">
                     
										    k8s-排错
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/28/K8S/mankubectl/">
                     
										    mankubectl
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Linux
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/12/27/Linux/CentOSYUM/">
                     
										    CentOSYUM
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/09/29/Linux/CentOS%E9%99%90%E5%88%B6%E7%94%A8%E6%88%B7%E7%9A%84%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8/">
                     
										    CentOS限制用户的资源使用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/01/17/Linux/LinuxLVM%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/">
                     
										    LinuxLVM基础操作
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/12/26/Linux/Linux%E4%B8%8B%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B8%A6%E5%AE%BD%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5/">
                     
										    Linux下查看进程的带宽使用情况
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/05/10/Linux/Linux%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0/">
                     
										    Linux内存相关笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/05/08/Linux/Linux%E5%88%9D%E5%A7%8B%E5%8C%96/">
                     
										    Linux初始化
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/03/25/Linux/Linux%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
                     
										    Linux正则表达式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/01/06/Linux/Linux%E7%9A%84inode%E7%9A%84%E7%90%86%E8%A7%A3/">
                     
										    Linux的inode的理解
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/05/09/Linux/NUMA%E6%9E%B6%E6%9E%84/">
                     
										    NUMA架构
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/03/21/Linux/disk_io.py%E2%80%93%E7%A3%81%E7%9B%98IO%E7%BB%9F%E8%AE%A1/">
                     
										    disk_io.py–磁盘IO统计
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/22/Linux/strace%E5%91%BD%E4%BB%A4/">
                     
										    strace命令
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/01/21/Linux/%E5%85%B3%E4%BA%8ELinux%E8%BF%9E%E6%8E%A5%E8%B7%9F%E8%B8%AA%E6%A8%A1%E5%9D%97/">
                     
										    关于Linux连接跟踪模块
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/07/22/Linux/%E6%B5%85%E8%B0%88Linux%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFLXC%E4%B9%8Bnamespace/">
                     
										    浅谈Linux容器技术LXC之namespace
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/07/03/Linux/%E6%B5%85%E8%B0%88Linux%E8%BD%BB%E9%87%8F%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AFLXC%E4%B9%8Bcgroup/">
                     
										    浅谈Linux轻量虚拟化技术LXC之cgroup
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/02/01/Linux/%E8%A2%AB%E9%BB%91%E4%B9%8B%E5%90%8E%E6%89%BE%E5%87%BA%E9%9A%90%E8%97%8F%E7%9A%84%E8%BF%9B%E7%A8%8B/">
                     
										    被黑之后找出隐藏的进程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/20/Linux/%E8%A7%A3%E5%86%B3Linux%E7%BB%88%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%96%B9%E5%90%91%E9%94%AE%E3%80%81%E9%80%80%E6%A0%BC%E9%94%AE%E7%AD%89%E5%87%BA%E7%8E%B0%E4%B9%B1%E7%A0%81%E7%9A%84%E9%97%AE%E9%A2%98/">
                     
										    解决Linux终端交互模式下方向键、退格键等出现乱码的问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/02/Linux/%E9%80%9A%E8%BF%87-proc-pid%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B/">
                     
										    通过-proc-pid了解一个进程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										MacOS
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/03/14/MacOS/MacBookPro%E5%A4%96%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E5%BC%80%E5%90%AFhidpi/">
                     
										    MacBookPro外接显示器开启hidpi
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/14/MacOS/macOS%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7%E5%90%88%E9%9B%86/">
                     
										    macOS常用技巧合集
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/03/21/MacOS/zsh%E2%80%93oh-my-zsh/">
                     
										    zsh–oh-my-zsh
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Nginx
									</a>
									
							<ul>
								<li class="file">
									<a href="/2019/11/30/Nginx/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/">
                     
										    IO多路复用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/02/28/Nginx/LVS-NGINX/">
                     
										    LVS-NGINX
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/03/19/Nginx/Nginx%E5%8A%A8%E6%80%81%E6%91%98%E9%99%A4/">
                     
										    Nginx动态摘除
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/04/18/Nginx/Nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/">
                     
										    Nginx常用配置
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Python
									</a>
									
							<ul>
								<li class="file">
									<a href="/2019/06/17/Python/Django-models/">
                     
										    Django-models
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/07/25/Python/PYTHON_Tips/">
                     
										    PYTHON_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/22/Python/Python-%E5%88%9D%E8%AF%86%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
                     
										    Python-初识多线程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/05/13/Python/Pythontipsfrom2021/">
                     
										    Pythontipsfrom2021
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/12/23/Python/Python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B7%B7%E5%90%88/">
                     
										    Python多进程多线程混合
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/03/02/Python/Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">
                     
										    Python异常处理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/02/23/Python/Python%E6%80%A7%E8%83%BD%E7%9B%B8%E5%85%B3/">
                     
										    Python性能相关
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/08/23/Python/Python%E6%8E%92%E5%BA%8F%E6%B1%87%E6%80%BB/">
                     
										    Python排序汇总
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/07/09/Python/celery/">
                     
										    celery
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/08/30/Python/django%E6%9E%B6%E6%9E%84%E5%9B%BE/">
                     
										    django架构图
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/22/Python/python-pip/">
                     
										    python-pip
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/10/Python/python-with%E8%AF%AD%E5%8F%A5/">
                     
										    python-with语句
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/15/Python/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/">
                     
										    python多线程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/01/30/Python/python%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/">
                     
										    python核心概念
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/30/Python/python%E8%B5%8B%E5%80%BC%E3%80%81%E6%B5%85%E6%8B%B7%E8%B4%9D%E5%92%8C%E6%B7%B1%E6%8B%B7%E8%B4%9D/">
                     
										    python赋值、浅拷贝和深拷贝
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/28/Python/python%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B/">
                     
										    python进程-线程-协程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/03/26/Python/%E4%BD%BF%E7%94%A8pyenv%E7%AE%A1%E7%90%86Python%E7%89%88%E6%9C%AC/">
                     
										    使用pyenv管理Python版本
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Shell
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/07/10/Shell/SHELL_Tips/">
                     
										    SHELL_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/22/Shell/Shellfork%E7%82%B8%E5%BC%B9/">
                     
										    Shellfork炸弹
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/01/Shell/shell%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%92%8C%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89/">
                     
										    shell多进程和信号捕捉
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										TCP
									</a>
									
							<ul>
								<li class="file">
									<a href="/2016/05/10/TCP/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/">
                     
										    TCP三次握手
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/11/11/TCP/TCP%E5%BB%BA%E8%BF%9E%E7%9A%84%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6/">
                     
										    TCP建连的重试机制
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/07/02/TCP/TCP%E7%9A%84%E5%8D%8A%E8%BF%9E%E6%8E%A5%E5%92%8C%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97/">
                     
										    TCP的半连接和全连接队列
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/08/16/TCP/tcpcopy/">
                     
										    tcpcopy
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/25/TCP/tcpdump/">
                     
										    tcpdump
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/09/11/TCP/tcpping/">
                     
										    tcpping
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										VPN
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/12/18/VPN/OpenVPN%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/">
                     
										    OpenVPN服务搭建
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/26/VPN/squid-authentication-by-NCSA-style/">
                     
										    squid-authentication-by-NCSA-style
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/26/VPN/%E4%BD%BF%E7%94%A8stunnel%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1/">
                     
										    使用stunnel加密通信
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										其他语言
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/12/02/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/GentelellaAlela/">
                     
										    GentelellaAlela
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/01/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/JS%E7%9A%84%E5%A4%A7%E6%8B%AC%E5%8F%B7%E5%92%8C%E4%B8%AD%E6%8B%AC%E5%8F%B7/">
                     
										    JS的大括号和中括号
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/05/24/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/LUA%E7%AC%94%E8%AE%B0/">
                     
										    LUA笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/15/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/Node.JS%E4%B9%8Bexpress%E5%85%A5%E9%97%A8/">
                     
										    Node.JS之express入门
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/07/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/NodeJS_Tips/">
                     
										    NodeJS_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/07/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/PHP_Tips/">
                     
										    PHP_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/22/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/PHP%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/">
                     
										    PHP环境相关操作
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/01/22/%E5%85%B6%E4%BB%96%E8%AF%AD%E8%A8%80/%E7%94%A8%E4%BA%8E%E6%93%8D%E4%BD%9Copenldap%E7%9A%84PHP%E7%B1%BB/">
                     
										    用于操作openldap的PHP类
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										回收站
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/01/28/%E5%9B%9E%E6%94%B6%E7%AB%99/%E8%BD%AC%E8%BD%BD-%E8%81%8C%E5%9C%BA%E7%A4%BC%E4%BB%AAA/">
                     
										    转载-职场礼仪A
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/01/28/%E5%9B%9E%E6%94%B6%E7%AB%99/%E8%BD%AC%E8%BD%BD-%E8%81%8C%E5%9C%BA%E7%A4%BC%E4%BB%AAB/">
                     
										    转载-职场礼仪B
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/01/28/%E5%9B%9E%E6%94%B6%E7%AB%99/%E8%BD%AC%E8%BD%BD-%E8%81%8C%E5%9C%BA%E7%A4%BC%E4%BB%AAC/">
                     
										    转载-职场礼仪C
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										大数据
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/05/11/%E5%A4%A7%E6%95%B0%E6%8D%AE/apache-flume/">
                     
										    apache-flume
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/08/%E5%A4%A7%E6%95%B0%E6%8D%AE/apache-kafka/">
                     
										    apache-kafka
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/04/%E5%A4%A7%E6%95%B0%E6%8D%AE/apache-maven/">
                     
										    apache-maven
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/04/11/%E5%A4%A7%E6%95%B0%E6%8D%AE/apache-storm/">
                     
										    apache-storm
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/10/%E5%A4%A7%E6%95%B0%E6%8D%AE/cloudera/">
                     
										    cloudera
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										存储
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/12/26/%E5%AD%98%E5%82%A8/CephFS%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">
                     
										    CephFS分布式文件系统
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/08/20/%E5%AD%98%E5%82%A8/ElasticSearch%E7%AC%94%E8%AE%B0/">
                     
										    ElasticSearch笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/04/27/%E5%AD%98%E5%82%A8/ownCloud%E6%9E%B6%E8%AE%BE%E4%BA%91%E7%9B%98/">
                     
										    ownCloud架设云盘
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/03/30/%E5%AD%98%E5%82%A8/owncloud%E5%8D%87%E7%BA%A7/">
                     
										    owncloud升级
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/09/15/%E5%AD%98%E5%82%A8/%E4%BD%BF%E7%94%A8cgroup%E9%99%90%E5%88%B6%E7%A3%81%E7%9B%98IO%E9%80%9F%E7%8E%87/">
                     
										    使用cgroup限制磁盘IO速率
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/07/03/%E5%AD%98%E5%82%A8/%E7%A3%81%E7%9B%98%E6%80%A7%E8%83%BD%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8C%87%E6%A0%87/">
                     
										    磁盘性能相关的指标
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										工作笔记
									</a>
									
							<ul>
								<li class="file">
									<a href="/2019/03/17/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E4%BA%92%E8%81%94%E7%BD%91%E6%9E%B6%E6%9E%84%EF%BC%8C%E7%A9%B6%E7%AB%9F%E4%B8%BA%E5%95%A5%E8%A6%81%E5%81%9A%E6%9C%8D%E5%8A%A1%E5%8C%96%EF%BC%9F/">
                     
										    互联网架构，究竟为啥要做服务化？
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/10/29/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E5%BA%94%E5%B1%8A%E7%94%9F%E9%9D%A2%E8%AF%95/">
                     
										    应届生面试
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/07/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E6%96%B0%E4%B9%B0%E7%9A%84%E7%94%B5%E8%84%91/">
                     
										    新买的电脑
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/21/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E7%AE%80%E5%8D%95%E7%9A%84SLA%E6%9C%8D%E5%8A%A1%E4%BC%98%E5%8C%96%E6%8C%87%E6%A0%87/">
                     
										    简单的SLA服务优化指标
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/01/13/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E9%83%A8%E7%BD%B2%E5%9F%BA%E4%BA%8EDocker%E7%9A%84graphite/">
                     
										    部署基于Docker的graphite
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/23/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/">
                     
										    问题汇总
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/02/03/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/%E9%A2%98%E7%9B%AE201903/">
                     
										    题目201903
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										开发工具
									</a>
									
							<ul>
								<li class="file">
									<a href="/2019/04/08/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/git-flow%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">
                     
										    git-flow分支管理最佳实践
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/11/27/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/%E5%88%A0%E9%99%A4github%E6%8F%90%E4%BA%A4%E8%AE%B0%E5%BD%95/">
                     
										    删除github提交记录
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/25/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Bgit%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%90%88%E9%9B%86/">
                     
										    命令行下git常用操作合集
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数据库
									</a>
									
							<ul>
								<li class="file">
									<a href="/2019/05/08/%E6%95%B0%E6%8D%AE%E5%BA%93/MongoDB/">
                     
										    MongoDB
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/05/09/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL_Tips/">
                     
										    MySQL_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/06/19/%E6%95%B0%E6%8D%AE%E5%BA%93/REDIS/">
                     
										    REDIS
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/02/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E9%9A%8F%E7%AC%94/">
                     
										    SQL随笔
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										编辑器
									</a>
									
							<ul>
								<li class="file">
									<a href="/2016/10/12/%E7%BC%96%E8%BE%91%E5%99%A8/Hexo/">
                     
										    Hexo
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/02/26/%E7%BC%96%E8%BE%91%E5%99%A8/Markdown%E8%BD%ACPDF/">
                     
										    Markdown转PDF
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/05/13/%E7%BC%96%E8%BE%91%E5%99%A8/PyCharm%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">
                     
										    PyCharm开发环境
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/10/02/%E7%BC%96%E8%BE%91%E5%99%A8/SublimeText%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD/">
                     
										    SublimeText常用功能
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/05/%E7%BC%96%E8%BE%91%E5%99%A8/vim%E7%9B%AE%E5%BD%95%E6%B5%8F%E8%A7%88%E6%8F%92%E4%BB%B6NERDTree/">
                     
										    vim目录浏览插件NERDTree
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/01/14/%E7%BC%96%E8%BE%91%E5%99%A8/vim%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8%E6%8F%92%E4%BB%B6YouCompleteMe/">
                     
										    vim自动补全插件YouCompleteMe
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/01/19/%E7%BC%96%E8%BE%91%E5%99%A8/vim%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%BC%8F/">
                     
										    vim视图模式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/01/%E7%BC%96%E8%BE%91%E5%99%A8/%E5%BC%80%E6%BA%90%E7%AC%94%E8%AE%B0leanote%E5%AE%89%E8%A3%85/">
                     
										    开源笔记leanote安装
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										网络
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/02/19/%E7%BD%91%E7%BB%9C/%E5%8D%8F%E8%AE%AE%E6%9D%82%E8%B0%88/">
                     
										    协议杂谈
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/01/27/%E7%BD%91%E7%BB%9C/%E5%9C%B0%E5%9D%80%E6%A0%8FURL%E5%9B%9E%E8%BD%A6%E5%90%8E%E7%9A%84%E6%8A%80%E6%9C%AF/">
                     
										    地址栏URL回车后的技术
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/08/20/%E7%BD%91%E7%BB%9C/%E5%A4%9A%E9%98%9F%E5%88%97%E7%BD%91%E5%8D%A1/">
                     
										    多队列网卡
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/21/%E7%BD%91%E7%BB%9C/%E7%BD%91%E5%8D%A1bond/">
                     
										    网卡bond
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/04/26/%E7%BD%91%E7%BB%9C/%E8%80%97%E6%97%B6%E7%AA%81%E5%A2%9E%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">
                     
										    耗时突增问题排查
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/10/08/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E5%92%8C%E4%BA%A4%E6%8D%A2/">
                     
										    路由和交换
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										读书笔记
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/06/29/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E3%80%8A%E7%BA%A2%E6%A5%BC%E6%A2%A6%E3%80%8B12%E6%94%AF%E6%9B%B2%E5%8F%8A%E8%B5%8F%E6%9E%90/">
                     
										    《红楼梦》12支曲及赏析
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/23/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E4%B8%80%E4%B9%9D%E5%9B%9B%E4%B9%9D%E5%92%8C%E7%BD%91%E7%BB%9C%E6%97%B6%E4%BB%A3%E7%9A%84%E6%84%8F%E8%AF%86%E5%BD%A2%E6%80%81/">
                     
										    一九四九和网络时代的意识形态
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/24/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%83%B5%E5%9B%BA%E5%9E%8B%E5%BF%83%E6%99%BA%E8%AD%A6%E7%A4%BA%E6%B8%85%E5%8D%95/">
                     
										    僵固型心智警示清单
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/04/08/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%91%BD%E7%90%86%E5%92%8C%E9%A3%8E%E6%B0%B4/">
                     
										    命理和风水
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/02/22/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E5%A4%A7%E6%98%8E%E7%8E%8B%E6%9C%9D1566%E8%AF%84%E4%BB%B7/">
                     
										    大明王朝1566评价
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/07/15/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%84%88%E6%BC%94%E6%84%88%E7%83%88%E7%9A%84%E9%98%B6%E5%B1%82%E5%88%86%E5%8C%96/">
                     
										    愈演愈烈的阶层分化
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/23/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%8A%80%E6%9C%AF%E8%B7%AF%E7%BA%BFor%E7%AE%A1%E7%90%86%E8%B7%AF%E7%BA%BF/">
                     
										    技术路线or管理路线
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/02/14/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%91%87%E5%8F%B7%E8%B4%AD%E8%BD%A6%E4%B8%AD%E7%9A%84%E5%B9%B3%E7%AD%89%E6%9D%83%E9%97%AE%E9%A2%98/">
                     
										    摇号购车中的平等权问题
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/06/18/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%9C%80%E6%B2%A1%E7%94%A8%E7%9A%84%E4%B8%9C%E8%A5%BF/">
                     
										    最没用的东西
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/02/22/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E6%AE%B5%E5%AD%90%E4%B8%8E%E5%90%AF%E5%8F%91/">
                     
										    段子与启发
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/06/11/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E7%A7%AF%E5%96%84%E4%B9%8B%E5%AE%B6%EF%BC%8C%E5%BF%85%E6%9C%89%E4%BD%99%E5%BA%86/">
                     
										    积善之家，必有余庆
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/05/14/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%82%A1%E7%A5%A8%E5%B8%B8%E8%AF%86/">
                     
										    股票常识
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/09/02/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%8A%82%E9%80%89%E3%80%8A%E6%B4%BB%E7%9D%80%E3%80%8B/">
                     
										    节选《活着》
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/08/27/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%8A%82%E9%80%89%E3%80%8A%E9%BB%84%E9%87%91%E6%97%B6%E4%BB%A3%E3%80%8B/">
                     
										    节选《黄金时代》
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/07/08/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">
                     
										    读书笔记
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/09/05/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%BD%AC%E4%BA%BA%E7%94%9F%E5%AE%9E%E8%B7%B5%E4%B8%AD%E7%9A%8411%E4%B8%AA%E5%BF%85%E6%9D%80%E6%8A%80/">
                     
										    转人生实践中的11个必杀技
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/04/08/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E8%BD%AC%E5%88%97%E5%85%B5%E4%B8%8E%E9%98%B6%E5%B1%82/">
                     
										    转列兵与阶层
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/08/01/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E9%AB%98%E5%96%84%E6%96%87%E5%B1%B1%E8%A5%BF%E8%AF%81%E5%88%B830%E5%91%A8%E5%B9%B4%E6%BC%94%E8%AE%B2/">
                     
										    高善文山西证券30周年演讲
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										运维
									</a>
									
							<ul>
								<li class="file">
									<a href="/2017/12/18/%E8%BF%90%E7%BB%B4/ANSIBLE_Tips/">
                     
										    ANSIBLE_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/02/24/%E8%BF%90%E7%BB%B4/Jenkins%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">
                     
										    Jenkins集群部署文档
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/22/%E8%BF%90%E7%BB%B4/OPS_Tips/">
                     
										    OPS_Tips
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/02/24/%E8%BF%90%E7%BB%B4/Rancher%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">
                     
										    Rancher集群部署文档
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/12/26/%E8%BF%90%E7%BB%B4/SaltStack/">
                     
										    SaltStack
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/03/11/%E8%BF%90%E7%BB%B4/daemontools%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B/">
                     
										    daemontools守护进程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/11/10/%E8%BF%90%E7%BB%B4/rsyslog%E5%8F%91%E9%80%81%E6%97%A5%E5%BF%97/">
                     
										    rsyslog发送日志
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/03/23/%E8%BF%90%E7%BB%B4/telegraf-influxdb-grafana/">
                     
										    telegraf-influxdb-grafana
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2021/02/08/%E8%BF%90%E7%BB%B4/%E5%85%A8%E5%B1%80limit%E5%8F%82%E6%95%B0%E5%92%8Csystemd%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%B8%8D%E4%B8%80%E8%87%B4/">
                     
										    全局limit参数和systemd进程的不一致
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/08/21/%E8%BF%90%E7%BB%B4/%E5%87%A0%E7%A7%8D%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%9C%BA%E6%99%AF/">
                     
										    几种日志分析场景
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/11/%E8%BF%90%E7%BB%B4/%E5%88%97%E5%87%BA%E5%8D%A0%E7%94%A8swap%E7%9A%84%E8%BF%9B%E7%A8%8B/">
                     
										    列出占用swap的进程
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2015/10/06/%E8%BF%90%E7%BB%B4/%E5%88%A9%E7%94%A8%E5%BE%AE%E4%BF%A1%E4%BC%81%E4%B8%9A%E5%8F%B7%E5%AE%9E%E7%8E%B0%E6%8A%A5%E8%AD%A6/">
                     
										    利用微信企业号实现报警
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2016/07/23/%E8%BF%90%E7%BB%B4/%E7%A6%81%E7%94%A8iptables%E9%93%BE%E6%8E%A5%E8%B7%9F%E8%B8%AA%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AE%89%E5%85%A8/">
                     
										    禁用iptables链接跟踪表是否安全
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/09/01/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B001/">
                     
										    运维笔记01
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/03/29/%E8%BF%90%E7%BB%B4/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">
                     
										    配置文件
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										随笔
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/12/11/%E9%9A%8F%E7%AC%94/%E4%B8%89%E5%B9%B4%E4%BA%86/">
                     
										    三年了
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/09/11/%E9%9A%8F%E7%AC%94/%E4%B8%AD%E7%A7%8B%E8%8A%82%E5%BF%AB%E4%B9%90/">
                     
										    中秋节快乐
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2019/03/29/%E9%9A%8F%E7%AC%94/%E4%BF%8F%E7%9A%AE%E8%AF%9D/">
                     
										    俏皮话
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2017/10/26/%E9%9A%8F%E7%AC%94/%E5%AE%9A%E5%9C%BA%E8%AF%97/">
                     
										    定场诗
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/08/07/%E9%9A%8F%E7%AC%94/%E6%96%B0%E7%9A%84%E5%BC%80%E5%A7%8B/">
                     
										    新的开始
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">
	Harbor镜像仓库集群部署文档
</h1>
<div class="article-meta">
	
	<span>MC</span>
	<span>2019-02-24 18:02:42</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true">
                        <a href="/categories/运维/">运维</a>
                        </i>
                      
                    </span>
                
            
    

    
		<span>Tags：</span>
            
                
                    <span>
                        <i class="fa fa-tag" aria-hidden="true">
                        <a href="/tags/migu/">migu</a>
                        </i>
                    </span>
                
            
    
		</div>

</div>

<div id="article-content">
	<h1 id="Harbor-镜像仓库集群部署文档"><a href="#Harbor-镜像仓库集群部署文档" class="headerlink" title="Harbor 镜像仓库集群部署文档"></a>Harbor 镜像仓库集群部署文档</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><h3 id="1-1-环境说明"><a href="#1-1-环境说明" class="headerlink" title="1.1. 环境说明"></a>1.1. 环境说明</h3><table>
<thead>
<tr>
<th>名称</th>
<th>版本</th>
</tr>
</thead>
<tbody><tr>
<td>操作系统</td>
<td>CentOS-7.0</td>
</tr>
<tr>
<td>docker</td>
<td>1.12.6</td>
</tr>
<tr>
<td>docker-compose</td>
<td>1.17.1</td>
</tr>
<tr>
<td>nginx</td>
<td>nginx-1.13.7</td>
</tr>
<tr>
<td>示例IP-harbor-1</td>
<td>172.16.1.134</td>
</tr>
<tr>
<td>示例IP-harbor-2</td>
<td>172.16.1.144</td>
</tr>
<tr>
<td>示例IP-nginx</td>
<td>172.16.1.154</td>
</tr>
</tbody></table>
<h3 id="1-2-Harbor集群架构图"><a href="#1-2-Harbor集群架构图" class="headerlink" title="1.2. Harbor集群架构图"></a>1.2. Harbor集群架构图</h3><ol>
<li><p>基于双主复制策略架构：<br><img src="/images/163245_a00419e2_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
</li>
<li><p>基于共享存储架构：<br><img src="/images/f_af78fcd0883e43f8fa27d56426eb067b.png" alt="image"></p>
</li>
</ol>
<p>后面我们会上述对两种模式分别进行安装部署的详细说明</p>
<h2 id="2-安装部署"><a href="#2-安装部署" class="headerlink" title="2. 安装部署"></a>2. 安装部署</h2><h3 id="2-1-下载解压"><a href="#2-1-下载解压" class="headerlink" title="2.1. 下载解压"></a>2.1. 下载解压</h3><pre><code class="line-numbers language-sh">wget https://github.com/vmware/harbor/releases/download/v1.2.2/harbor-offline-installer-v1.2.2.tgz
tar zxvf harbor-offline-installer-v1.2.2.tgz
cd harbor
</code></pre>
<p>其他版本参见地址：<br><a target="_blank" rel="noopener" href="https://github.com/vmware/harbor/releases">https://github.com/vmware/harbor/releases</a></p>
<h3 id="2-2-调整配置"><a href="#2-2-调整配置" class="headerlink" title="2.2. 调整配置"></a>2.2. 调整配置</h3><pre><code class="line-numbers language-sh">#改成本机IP地址或者仓库域名
hostname = 172.16.1.134
#MySQL密码
db_password = root123
#仓库admin用户密码
harbor_admin_password = Harbor12345
</code></pre>
<h3 id="2-3-安装部署"><a href="#2-3-安装部署" class="headerlink" title="2.3. 安装部署"></a>2.3. 安装部署</h3><pre><code class="line-numbers language-sh">./install.sh
</code></pre>
<p>默认配置安装后启用80端口，通过浏览器访问Harbor仓库UI，默认用户名和密码为：<br>用户名：admin<br>密码：Harbor12345</p>
<pre><code>http://172.16.1.134/
</code></pre>
<p>我们可以看到系统各个模块如下：</p>
<ul>
<li>项目：新增&#x2F;删除项目，查看镜像仓库，给项目添加成员、查看操作日志、复制项目等</li>
<li>日志：仓库各个镜像create、push、pull等操作日志</li>
<li>系统管理<ul>
<li>用户管理：新增&#x2F;删除用户、设置管理员等</li>
<li>复制管理：新增&#x2F;删除从库目标、新建&#x2F;删除&#x2F;启停复制规则等</li>
<li>配置管理：认证模式、复制、邮箱设置、系统设置等</li>
</ul>
</li>
<li>其他设置<ul>
<li>用户设置：修改用户名、邮箱、名称信息</li>
<li>修改密码：修改用户密码</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：非系统管理员用户登录，只能看到有权限的项目和日志，其他模块不可见。</p>
</blockquote>
<h3 id="2-4-用非默认端口安装"><a href="#2-4-用非默认端口安装" class="headerlink" title="2.4. 用非默认端口安装"></a>2.4. 用非默认端口安装</h3><p>调整端口涉及两个配置文件(以默认80端口改为8888端口为例)</p>
<ol>
<li><code>docker-compose.yml</code> 配置nginx容器端口映射配置</li>
</ol>
<pre><code>   ports:
     - 8888:80
     - 443:443
     - 4443:4443
</code></pre>
<ol start="2">
<li><code>harbor.cfg</code> hostname中需在hostname后加端口标识</li>
</ol>
<pre><code>hostname = 172.16.1.134:8888
</code></pre>
<ol start="3">
<li>执行安装</li>
</ol>
<pre><code>./install
</code></pre>
<p><img src="/images/102303_72083bff_381055.png" alt="安装成功" title="屏幕截图.png"></p>
<h3 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a>测试安装</h3><p>登录测试</p>
<pre><code class="line-numbers language-sh">docker login -u admin -p Harbor12345 172.16.1.134
</code></pre>
<p>报错如下</p>
<pre><code>Error response from daemon: Get https://172.16.1.134/v1/users/: http: server gave HTTP response to HTTPS client
</code></pre>
<p>这是因为docker默认采用https访问registry，因此我们需要在docker engine的配置中，添加–insecure-registry option。</p>
<pre><code class="line-numbers language-sh">$ cat /etc/sysconfig/docker
OPTIONS=&#39; --insecure-registry=172.16.1.134 &#39;
</code></pre>
<p>重启docker engine后尝试再次登录harbor</p>
<pre><code class="line-numbers language-sh">$ systemctl restart docker
$ docker login -u admin -p Harbor12345 172.16.1.134
Login Succeeded
</code></pre>
<h2 id="3-测试应用"><a href="#3-测试应用" class="headerlink" title="3. 测试应用"></a>3. 测试应用</h2><h3 id="3-1-新建项目"><a href="#3-1-新建项目" class="headerlink" title="3.1. 新建项目"></a>3.1. 新建项目</h3><p>我们新建一个名称为<code>migu</code>的项目，设置不公开。注意：当项目设为公开后，任何人都有此项目下镜像的读权限。命令行用户不需要“docker login”就可以拉取此项目下的镜像。</p>
<p><img src="/images/102240_15d8f9fb_381055.png" alt="新建项目" title="屏幕截图.png"></p>
<h3 id="3-2-打包本地镜像push到仓库"><a href="#3-2-打包本地镜像push到仓库" class="headerlink" title="3.2. 打包本地镜像push到仓库"></a>3.2. 打包本地镜像push到仓库</h3><pre><code class="line-numbers language-sh">docker tag $&#123;local-image-name&#125; 172.16.1.134/migu/$&#123;app-name&#125;:0.1
docker push 172.16.1.134/migu/$&#123;app-name&#125;:0.1
</code></pre>
<p>从Harbor管理页面上可以看到刚刚push上的镜像信息</p>
<h2 id="4-Harbor镜像复制"><a href="#4-Harbor镜像复制" class="headerlink" title="4. Harbor镜像复制"></a>4. Harbor镜像复制</h2><p>实现两台Harbor服务器相互复制，互为主备的效果。首先我们至少配置两个Harbor服务 ：</p>
<blockquote>
<p>Harbor1：172.16.1.134<br>Harbor2：172.16.1.144</p>
</blockquote>
<p>以配置migu项目镜像赋值为例，我们在Harbor1和Harbor2上相互配置彼此的地址，即配置相互复制。</p>
<p>配置复制规则，点击<code>项目</code> -&gt; <code>migu</code> -&gt; <code>复制</code>-&gt; <code>新建复制规则</code>，填写名称、目标名、目标URL等信息。 注意：目标URL这里是复制节点Harbor2地址，<code>http://172.16.1.144</code> ，用户名和密码为Harbor2配置的admin账户和密码。一旦勾选启用，那么新建复制规则完成后，立马就检测需要同步的image自动同步。</p>
<blockquote>
<p>配置完后，在Harbor2上根据上述同样的步骤镜像配置，复制的对象选择Harbor1，这样就实现了镜像相互同步，互为主备的目的。</p>
</blockquote>
<p><img src="/images/102119_69b8338e_381055.png" alt="复制配置" title="屏幕截图.png"></p>
<p>开始push镜像到Harbor1上：</p>
<pre><code class="line-numbers language-sh">$docker tag vmware/harbor-adminserver:v1.2.2 172.16.1.134/migu/test-image-replication:1.0
docker push 172.16.1.134/migu/test-image-replication:1.0
The push refers to a repository [172.16.1.134/migu/test-image-replication]
4fe250d3c912: Preparing
2202528221a2: Preparing
abf0579c40fd: Preparing
dd60b611baaa: Preparing
unauthorized: authentication required
$ docker login -u admin -p Harbor12345 172.16.1.134
Login Succeeded
$ docker push 172.16.1.134/migu/test-image-replication:1.0
The push refers to a repository [172.16.1.134/migu/test-image-replication]
4fe250d3c912: Pushed
2202528221a2: Pushed
abf0579c40fd: Pushed
dd60b611baaa: Pushed
1.0: digest: sha256:80bfbc20a1ee2bc6b05dfe31f1e082c08961a0f62e94089ef952800e92a1fc4c size: 1157
</code></pre>
<p>push到Harbor1的镜像已经出现Harbor2的仓库里，并且push日志也同步过来了：<br><img src="/images/102053_a5948a74_381055.png" alt="复制日志" title="屏幕截图.png"></p>
<blockquote>
<p>修改镜像版本号，push到Harbor2，正常情况下会看到镜像成功的从Harbor2同步到Harbor1上。</p>
</blockquote>
<h2 id="5-Harbor启动和停止"><a href="#5-Harbor启动和停止" class="headerlink" title="5. Harbor启动和停止"></a>5. Harbor启动和停止</h2><p><code>common/templates</code> 配置文件模板目录<br><code>common/config</code> 目录是放置根据模板生产的配置文件</p>
<p>对于运行中的Harbor修改配置，一般选择修改模板文件，然后采用<code>./prepare</code> 命令生成配置文件，最后重启Harbor服务。也可以直接修改config下的文件，重启服务生效，但是不推荐。</p>
<pre><code class="line-numbers language-sh">#停止
cd /path/to/harbor/ &amp;&amp; docker-compose stop

#启动
cd /path/to/harbor/ &amp;&amp;  docker-compose start

#重启
cd /path/to/harbor/ &amp;&amp; docker-compose restart
</code></pre>
<h2 id="6-Harbor高可用-基于本地存储"><a href="#6-Harbor高可用-基于本地存储" class="headerlink" title="6. Harbor高可用(基于本地存储)"></a>6. Harbor高可用(基于本地存储)</h2><p>使用Nginx作为两台Harbor服务器负载均衡器，为防止session共享问题，Nginx负载均衡策略要从默认的RoundRobin算法调整为IpHash，即一个客户端的请求只定位到一台Harbor服务器</p>
<h3 id="6-1-Nginx安装部署"><a href="#6-1-Nginx安装部署" class="headerlink" title="6.1. Nginx安装部署"></a>6.1. Nginx安装部署</h3><ol>
<li>由于生产环境无法连接公网，同样使用本地下载镜像打包上传的方式进行安装</li>
</ol>
<pre><code class="line-numbers language-sh">docker pull docker.io/nginx
docker save docker.io/nginx &gt; harbor-nginx.tgz
#上传到服务器
...
docker load &lt; harbor-nginx.tgz
</code></pre>
<ol start="2">
<li>为方便配置和管理，我们把Nginx配置目录和日志目录挂载到宿主机</li>
</ol>
<ul>
<li>启动容器把Nginx默认配置拷贝到宿主机的目录</li>
</ul>
<pre><code class="line-numbers language-sh">mkdir -vp /data/harbor-nginx/conf
mkdir -vp /data/harbor-nginx/logs
docker run -d --name nginx docker.io/nginx
docker cp nginx:/etc/nginx/ /data/harbor-nginx/conf
docker rm -f nginx
</code></pre>
<ul>
<li>目录结构</li>
</ul>
<pre><code>[root@localhost harbor-nginx]# pwd
/data/harbor-nginx
[root@localhost harbor-nginx]# tree
.
├── conf
│   ├── fastcgi_params
│   ├── koi-utf
│   ├── koi-win
│   ├── mime.types
│   ├── modules -&gt; /usr/lib/nginx/modules
│   ├── nginx.conf
│   ├── scgi_params
│   ├── uwsgi_params
│   └── win-utf
└── logs
    ├── access.log
    └── error.log
</code></pre>
<ul>
<li>修改Nginx配置，增加负载均衡配置</li>
</ul>
<p>定义一个Nginx的upstream，名字叫harbor</p>
<pre><code class="line-numbers language-sh">$ nginx.conf

user  nginx;
worker_processes  1;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
events &#123;
    worker_connections  1024;
&#125;

#Nginx上其他模块的HTTP代理
http &#123;
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$upstream_addr&quot; &quot;$upstream_status&quot;&#39; ;

    upstream ceph-dashboard &#123;
        ip_hash;
        server 10.46.235.126:7000 max_fails=3 fail_timeout=30s weight=20;
    &#125;

    server &#123;
        listen 0.0.0.0:19007;
        server_name 0.0.0.0;
        charset utf-8;
        location / &#123;
            proxy_set_header   X-Forwarded-Proto $scheme;
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
            proxy_pass http://ceph-dashboard;
        &#125;
        access_log /var/log/nginx/access-ceph-dashboard.log main;
    &#125;
&#125;

#用于Harbor的TCP代理
stream &#123;
    log_format  main  &#39;$remote_addr - [$time_local] $status &quot;$upstream_addr&quot; &#39; ;

    upstream harbor &#123;
        hash $remote_addr consistent;
        server 172.16.1.134:80 max_fails=3 fail_timeout=30s weight=20;
        server 172.16.1.144:80 max_fails=3 fail_timeout=30s weight=20;
    &#125;

    server &#123;
        listen 0.0.0.0:8888;
        proxy_responses 1;
        proxy_timeout 900s;
        proxy_pass harbor;
        access_log /var/log/nginx/access-harbor.log main;
    &#125;
&#125;
</code></pre>
<blockquote>
<p>使用Nginx的HTTP反向代理会报错POST的size过大，通过<code>client_max_body_size 0</code>解决。 此时，可以正常认证和拉取镜像，但是无法push镜像，报错如下：</p>
</blockquote>
<pre><code>rror parsing HTTP 405 response body: invalid character &#39;&lt;&#39; looking for beginning of value: &quot;&lt;html&gt;\r\n&lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;\r\n&lt;body bgcolor=\&quot;white\&quot;&gt;\r\n&lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt;\r\n&lt;hr&gt;&lt;center&gt;unknow&lt;/center&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n&quot;
</code></pre>
<p>根据报错内容初步判断客户端无法解析服务端返回的HTML的数据格式，改为上述配置中Nginx的TCP代理后果然可以正常push镜像。（2017-12-15 23:46:26 更新）</p>
<ul>
<li>启动Nginx（8888为测试端口，需修改成最终申请的端口号）</li>
</ul>
<pre><code class="line-numbers language-sh">docker run -d  --name lb -v /data/harbor-nginx/conf:/etc/nginx -v /data/harbor-nginx/logs:/var/log/nginx --net=host
 docker.io/nginx
</code></pre>
<h3 id="6-2-docker环境配置"><a href="#6-2-docker环境配置" class="headerlink" title="6.2. docker环境配置"></a>6.2. docker环境配置</h3><p>由于两台Harbor服务器的接口地址由本机IP改成了负载均衡Nginx的地址和端口，需要在每台要操作本Harbor仓库的docker主机上修改设置：</p>
<pre><code class="line-numbers language-sh">$ cat /etc/sysconfig/docker
OPTIONS=&#39; --insecure-registry=172.16.1.154:8888 &#39;
</code></pre>
<h3 id="6-3-Nginx-测试"><a href="#6-3-Nginx-测试" class="headerlink" title="6.3. Nginx 测试"></a>6.3. Nginx 测试</h3><p>和测试Harbor仓库单机步骤一样，只需把Harbor单机IP地址调整为Nginx的地址和端口号。（参见上述第三部分）</p>
<h3 id="6-4-Nginx高可用"><a href="#6-4-Nginx高可用" class="headerlink" title="6.4. Nginx高可用"></a>6.4. Nginx高可用</h3><p>当前计划三台服务器用于Harbor集群，初步规划如下:</p>
<table>
<thead>
<tr>
<th>服务器</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>Server1</td>
<td>Harbor1</td>
</tr>
<tr>
<td>Server2</td>
<td>Harbor2 + Nginx-备</td>
</tr>
<tr>
<td>Server3</td>
<td>Nginx-主</td>
</tr>
</tbody></table>
<h2 id="7-Harbor高可用-基于共享存储-CephFS"><a href="#7-Harbor高可用-基于共享存储-CephFS" class="headerlink" title="7. Harbor高可用(基于共享存储-CephFS)"></a>7. Harbor高可用(基于共享存储-CephFS)</h2><h3 id="7-1-CephFS共享存储简介"><a href="#7-1-CephFS共享存储简介" class="headerlink" title="7.1. CephFS共享存储简介"></a>7.1. CephFS共享存储简介</h3><p>Ceph是高性能的分布式存储系统，提供三种存储场景，分别是分布式块存储（Block Storage）、分布式对象存储（Object Storage），分布式文件系统（CephFS），作为Harbor仓库后端的存储系统，我们用的是Ceph的文件系统，即CephFS。<br>Ceph的主要组件包括OSD，MONITOR和MDS，各个组件的作用描述如下：</p>
<ul>
<li><p><code>Ceph OSDs</code>: Ceph OSD 守护进程（ Ceph OSD ）的功能是存储数据，处理数据的复制、恢复、回填、再均衡，并通过检查其他OSD 守护进程的心跳来向 Ceph Monitors 提供一些监控信息。当 Ceph 存储集群设定为有2个副本时，至少需要2个 OSD 守护进程，集群才能达到 active+clean 状态（ Ceph 默认有3个副本，但你可以调整副本数）。</p>
</li>
<li><p><code>Monitors</code>: Ceph Monitor维护着展示集群状态的各种图表，包括监视器图、 OSD 图、归置组（ PG ）图、和 CRUSH 图。 Ceph 保存着发生在Monitors 、 OSD 和 PG上的每一次状态变更的历史信息（称为 epoch ）。</p>
</li>
<li><p><code>MDSs</code>: Ceph 元数据服务器（ MDS ）为 Ceph 文件系统存储元数据（也就是说，Ceph 块设备和 Ceph 对象存储不使用MDS ）。元数据服务器使得 POSIX 文件系统的用户们，可以在不对 Ceph 存储集群造成负担的前提下，执行诸如 ls、find 等基本命令。</p>
</li>
</ul>
<blockquote>
<p>Ceph 把客户端数据保存为存储池内的对象。通过使用 CRUSH 算法， Ceph 可以计算出哪个归置组（PG）应该持有指定的对象(Object)，然后进一步计算出哪个 OSD 守护进程持有该归置组。 CRUSH 算法使得 Ceph 存储集群能够动态地伸缩、再均衡和修复。</p>
</blockquote>
<h3 id="7-2-部署CephFS分布式文件系统"><a href="#7-2-部署CephFS分布式文件系统" class="headerlink" title="7.2. 部署CephFS分布式文件系统"></a>7.2. 部署CephFS分布式文件系统</h3><h4 id="7-2-1-环境说明"><a href="#7-2-1-环境说明" class="headerlink" title="7.2.1. 环境说明"></a>7.2.1. 环境说明</h4><p>Ceph官方文档中建议通过自带的ceph-deploy通过网络进行在线安装，比如CentOS系统就基于yum生态安装，但是考虑到生产环境可能没有公网连接，我们采用docker方式来安装部署CephFS，而且这样做更容易对版本和各个组件进行细致的把控。</p>
<p>为了更清晰的掌握部署环节，现对各个角色规划如下（主机名含义忽略）：</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>IP地址</th>
<th>角色</th>
<th>序号</th>
</tr>
</thead>
<tbody><tr>
<td>server</td>
<td>172.16.149.129</td>
<td>mon,osd,mds,mgr</td>
<td>ceph-1</td>
</tr>
<tr>
<td>agent</td>
<td>172.16.149.130</td>
<td>mon,osd,mds</td>
<td>ceph-2</td>
</tr>
<tr>
<td>server2</td>
<td>172.16.149.131</td>
<td>mon,osd,mds</td>
<td>ceph-3</td>
</tr>
</tbody></table>
<h4 id="7-2-2-准备工作"><a href="#7-2-2-准备工作" class="headerlink" title="7.2.2. 准备工作"></a>7.2.2. 准备工作</h4><ul>
<li>下载镜像并推送到内网临时私有仓库，方便在每台ceph节点上快速启动docker容器</li>
</ul>
<pre><code>docker pull r6w9c7qa.mirror.aliyuncs.com/ceph/daemon:latest
docker tag r6w9c7qa.mirror.aliyuncs.com/ceph/daemon:latest $&#123;harbor-server&#125;/ceph/daemon:latest
docker push $&#123;harbor-server&#125;/ceph/daemon:latest
</code></pre>
<ul>
<li>在每个ceph节点上设置主机名和ip地址的映射（如果内网没有DNS服务）</li>
</ul>
<pre><code class="line-numbers language-sh">$ cat /etc/hosts
172.16.149.129 server ceph-1
172.16.149.130 agent ceph-2
172.16.149.131 server2 ceph-3
</code></pre>
<ul>
<li>设置时间同步</li>
</ul>
<pre><code class="line-numbers language-sh">$ crontab -l
*/10 * * * * /sbin/ntpdate private-time-server-ip; hwclock -w
</code></pre>
<ul>
<li>硬件环境<br> CephFS存储节点需要准备一块单独的磁盘，用于存放数据</li>
</ul>
<h4 id="7-2-3-部署安装"><a href="#7-2-3-部署安装" class="headerlink" title="7.2.3. 部署安装"></a>7.2.3. 部署安装</h4><h5 id="7-2-3-1-在ceph-1上启动monitor，在镜像的参数中是mon"><a href="#7-2-3-1-在ceph-1上启动monitor，在镜像的参数中是mon" class="headerlink" title="7.2.3.1. 在ceph-1上启动monitor，在镜像的参数中是mon"></a>7.2.3.1. 在ceph-1上启动monitor，在镜像的参数中是<code>mon</code></h5><pre><code class="line-numbers language-sh">docker run -d \
    --name mon \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    -e MON_IP=172.16.149.129 \
    -e CEPH_PUBLIC_NETWORK=172.16.149.0/24 \
    $&#123;harbor-server&#125;/ceph/daemon:latest mon
</code></pre>
<h5 id="7-2-3-2-拷贝配置文件到另外2台节点"><a href="#7-2-3-2-拷贝配置文件到另外2台节点" class="headerlink" title="7.2.3.2. 拷贝配置文件到另外2台节点"></a>7.2.3.2. 拷贝配置文件到另外2台节点</h5><pre><code class="line-numbers language-sh">scp -r /var/lib/ceph/bootstrap* ceph-2:/var/lib/ceph/
scp -r /var/lib/ceph/bootstrap* ceph-3:/var/lib/ceph/
scp -r /etc/ceph/* ceph-2:/etc/ceph/
scp -r /etc/ceph/* ceph-3:/etc/ceph/
</code></pre>
<h5 id="7-2-3-3-分别在ceph-2和ceph-3上启动monitor"><a href="#7-2-3-3-分别在ceph-2和ceph-3上启动monitor" class="headerlink" title="7.2.3.3. 分别在ceph-2和ceph-3上启动monitor"></a>7.2.3.3. 分别在ceph-2和ceph-3上启动monitor</h5><pre><code class="line-numbers language-sh">#ceph-2
docker run -d \
    --name mon \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    -e MON_IP=172.16.149.130 \
    -e CEPH_PUBLIC_NETWORK=172.16.149.0/24 \
    $&#123;harbor-server&#125;/ceph/daemon:latest mon

#ceph-3
docker run -d \
    --name mon \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    -e MON_IP=172.16.149.131 \
    -e CEPH_PUBLIC_NETWORK=172.16.149.0/24 \
    $&#123;harbor-server&#125;/ceph/daemon:latest mon
</code></pre>
<h5 id="7-2-3-4-至此，monitor组件在集群中已经启动完毕，检测是否启动成功"><a href="#7-2-3-4-至此，monitor组件在集群中已经启动完毕，检测是否启动成功" class="headerlink" title="7.2.3.4. 至此，monitor组件在集群中已经启动完毕，检测是否启动成功"></a>7.2.3.4. 至此，monitor组件在集群中已经启动完毕，检测是否启动成功</h5><pre><code>$ docker exec mon ceph mon stat
e3: 3 mons at &#123;agent=172.16.149.130:6789/0,server=172.16.149.129:6789/0,server2=172.16.149.131:6789/0&#125;, election epoch 20, leader 0 server, quorum 0,1,2 server,agent,server2
</code></pre>
<p>如上所示，三台节点已经启动成功</p>
<h5 id="7-2-3-5-格式化磁盘并挂载"><a href="#7-2-3-5-格式化磁盘并挂载" class="headerlink" title="7.2.3.5. 格式化磁盘并挂载"></a>7.2.3.5. 格式化磁盘并挂载</h5><p>假设OSD节点上数据磁盘都是&#x2F;dev&#x2F;sdb，20GB，在启动OSD之前先对磁盘进行分区和格式化，用到的命令为<code>fdisk</code>和<code>mkfs.xfs</code></p>
<p>对磁盘进行分区：</p>
<pre><code class="line-numbers language-sh">$ fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0x7c55a278.

#新建分区
Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended

#所有空间全部在一个主分区
Select (default p): p
Partition number (1-4, default 1):
First sector (2048-41943039, default 2048):
Using default value 2048
Last sector, +sectors or +size&#123;K,M,G&#125; (2048-41943039, default 41943039):
Using default value 41943039
Partition 1 of type Linux and of size 20 GiB is set

#保存配置
Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
</code></pre>
<p>对磁盘进行格式化：</p>
<pre><code class="line-numbers language-sh">$ mkfs.xfs /dev/sdb1
meta-data=/dev/sdb1              isize=256    agcount=4, agsize=1310656 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=0        finobt=0
data     =                       bsize=4096   blocks=5242624, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=0
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

$ mkdir /ceph-data

$ mount /dev/sdb1 /ceph-data/

$ df -h /ceph-data/
Filesystem      Size  Used Avail Use% Mounted on
/dev/sdb1        20G  486M   20G   3% /ceph-data
</code></pre>
<p>上面工作完成后开始安装OSD存储节点</p>
<h5 id="7-2-3-6-部署启动OSD"><a href="#7-2-3-6-部署启动OSD" class="headerlink" title="7.2.3.6. 部署启动OSD"></a>7.2.3.6. 部署启动OSD</h5><p>在每个ceph节点上执行如下命令，创建OSD：</p>
<pre><code class="line-numbers language-sh">docker run -d \
    --name osd \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    -v /dev/:/dev/ \
    -v /ceph-data:/var/lib/ceph/osd \
    --privileged=true \
    $&#123;harbor-server&#125;/ceph/daemon:latest osd_directory
</code></pre>
<h5 id="7-2-3-7-部署启动MDS"><a href="#7-2-3-7-部署启动MDS" class="headerlink" title="7.2.3.7. 部署启动MDS"></a>7.2.3.7. 部署启动MDS</h5><p>在每个ceph节点上执行如下命令，创建MDS：</p>
<pre><code class="line-numbers language-sh">docker run -d \
    --name mds \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    -e CEPHFS_CREATE=1 \
    172.16.149.129/ceph/daemon:latest mds
</code></pre>
<h5 id="7-2-3-8-部署启动MGR"><a href="#7-2-3-8-部署启动MGR" class="headerlink" title="7.2.3.8. 部署启动MGR"></a>7.2.3.8. 部署启动MGR</h5><p>在ceph-1上启动即可</p>
<pre><code class="line-numbers language-sh">docker run -d \
    --name mgr \
    --net=host \
    -v /etc/ceph:/etc/ceph \
    -v /var/lib/ceph/:/var/lib/ceph/ \
    172.16.149.129/ceph/daemon:latest mgr
</code></pre>
<p>mgr启动后可通过浏览器访问如下页面，查看集群状态信息</p>
<pre><code>http://ecph-1:7000/
</code></pre>
<p><img src="/images/000754_ffe69596_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h5 id="7-2-3-9-验证和查看集群状态"><a href="#7-2-3-9-验证和查看集群状态" class="headerlink" title="7.2.3.9. 验证和查看集群状态"></a>7.2.3.9. 验证和查看集群状态</h5><pre><code>$ docker exec mon ceph status

  cluster:
    id:     81da7da9-0063-4443-8964-57947acc7304
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum server,agent,server2
    mgr: server(active)
    mds: cephfs-1/1/1 up  &#123;0=server=up:active&#125;, 2 up:standby
    osd: 3 osds: 3 up, 3 in

  data:
    pools:   2 pools, 128 pgs
    objects: 23 objects, 1032 kB
    usage:   629 MB used, 60777 MB / 61407 MB avail
    pgs:     128 active+clean
</code></pre>
<p><strong>如果是上述状态，则3节点的ceph集群就安装完成，可以看到我们启动了3个Monitor，3个OSD，3个MDS（1个up和2个standby），1个mgr</strong></p>
<p>集群状态和分布：<br><img src="/images/001052_e25e06ef_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>OSD节点状态：<br><img src="/images/001145_8bc9b7dd_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h3 id="7-3-挂载并使用CephFS分布式文件系统"><a href="#7-3-挂载并使用CephFS分布式文件系统" class="headerlink" title="7.3. 挂载并使用CephFS分布式文件系统"></a>7.3. 挂载并使用CephFS分布式文件系统</h3><h4 id="7-3-1-客户端服务器升级内核"><a href="#7-3-1-客户端服务器升级内核" class="headerlink" title="7.3.1. 客户端服务器升级内核"></a>7.3.1. 客户端服务器升级内核</h4><p>使用Linux系统自带的mount命令挂载CephFS，需要在内核4.0及以上才能支持，现在开始升级内核</p>
<blockquote>
<p>内核版本不支持的报错如下：<br>mount: 172.16.149.130:6789:&#x2F;: can’t read superblock</p>
</blockquote>
<ol>
<li>升级之前内核版本：</li>
</ol>
<pre><code>$ uname -r
3.10.0-229.el7.x86_64
</code></pre>
<ol start="2">
<li>开始升级：</li>
</ol>
<pre><code>$ rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
$ rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
$ yum --enablerepo=elrepo-kernel install  kernel-ml-devel kernel-ml

Total                                                                                                                                        1.1 MB/s |  54 MB  00:00:47
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
Warning: RPMDB altered outside of yum.
  Installing : kernel-ml-devel-4.14.5-1.el7.elrepo.x86_64                                                                                                                1/2
  Installing : kernel-ml-4.14.5-1.el7.elrepo.x86_64                                                                                                                      2/2

  Verifying  : kernel-ml-4.14.5-1.el7.elrepo.x86_64                                                                                                                      1/2
  Verifying  : kernel-ml-devel-4.14.5-1.el7.elrepo.x86_64                                                                                                                2/2

Installed:
  kernel-ml.x86_64 0:4.14.5-1.el7.elrepo                         kernel-ml-devel.x86_64 0:4.14.5-1.el7.elrepo

Complete!
</code></pre>
<ol start="3">
<li>设置默认启动内核：</li>
</ol>
<pre><code>$ awk -F\&#39; &#39;$1==&quot;menuentry &quot; &#123;print $2&#125;&#39; /etc/grub2.cfg
CentOS Linux (4.14.5-1.el7.elrepo.x86_64) 7 (Core)
CentOS Linux 7 (Core), with Linux 3.10.0-229.el7.x86_64
CentOS Linux 7 (Core), with Linux 0-rescue-56e3e3970b664066b7d3ba5687c0972a

#最新安装的内核在第一个位置，所有是第0个内核

$ grub2-set-default 0
</code></pre>
<ol start="4">
<li>重启:</li>
</ol>
<pre><code class="line-numbers language-sh">reboot
</code></pre>
<ol start="5">
<li>内核升级完成：</li>
</ol>
<pre><code>$ uname -r
4.14.5-1.el7.elrepo.x86_64
</code></pre>
<blockquote>
<p>如果无法用yum方式升级可以考虑采用rpmrebuild把已经升级好内核的服务器的RPM导出到本地，再在内网机器使用rpm命令进行安装的方法。</p>
</blockquote>
<h4 id="7-3-2-使用mount命令挂载CephFS"><a href="#7-3-2-使用mount命令挂载CephFS" class="headerlink" title="7.3.2. 使用mount命令挂载CephFS"></a>7.3.2. 使用<code>mount</code>命令挂载CephFS</h4><p>创建Harbor仓库使用的挂载点： <code>/mnt/harbor</code></p>
<p>默认CephFS的用户名为<code>admin</code>，密码为<code>/etc/ceph/ceph.client.admin.keyring</code>中的key字段：</p>
<pre><code>$ cat /etc/ceph/ceph.client.admin.keyring
[client.admin]
    key = AQCzojBaOLQeBhAAj6qRTje1pFONx5e1d2lIMw==
    auid = 0
    caps mds = &quot;allow&quot;
    caps mgr = &quot;allow *&quot;
    caps mon = &quot;allow *&quot;
    caps osd = &quot;allow *&quot;
</code></pre>
<p>使用主机名作为CephFS节点会报错：</p>
<pre><code>$ dmesg

[  290.891392] libceph: parse_ips bad ip &#39;server:6789,agent:6789,server2:6789&#39;
</code></pre>
<p>改为IP地址后即可：</p>
<pre><code class="line-numbers language-sh">$ mkdir -vp /mnt/harbor

$ mount -t ceph 172.16.149.129:6789,172.16.149.130:6789,172.16.149.131:6789:/ /mnt/harbor -o name=admin,secret=AQCzojBaOLQeBhAAj6qRTje1pFONx5e1d2lIMw==

$ df -h  /mnt/harbor
Filesystem                                                     Size  Used Avail Use% Mounted on
172.16.149.129:6789,172.16.149.130:6789,172.16.149.131:6789:/   29G  276M   28G   1% /mnt/harbor
</code></pre>
<p><img src="/images/001418_92133b0c_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h4 id="7-3-3-设置开机自动挂载"><a href="#7-3-3-设置开机自动挂载" class="headerlink" title="7.3.3. 设置开机自动挂载"></a>7.3.3. 设置开机自动挂载</h4><pre><code class="line-numbers language-sh">$ /etc/fstab
172.16.149.129:6789,172.16.149.130:6789,172.16.149.131:6789:/ /mnt/harbor   ceph    name=admin,secret=AQCzojBaOLQeBhAAj6qRTje1pFONx5e1d2lIMw==,noatime,_netdev    0      0
</code></pre>
<h3 id="7-4-把Harbor改为使用共享存储的模式"><a href="#7-4-把Harbor改为使用共享存储的模式" class="headerlink" title="7.4. 把Harbor改为使用共享存储的模式"></a>7.4. 把Harbor改为使用共享存储的模式</h3><h4 id="7-4-1-设置独立MySQL数据库"><a href="#7-4-1-设置独立MySQL数据库" class="headerlink" title="7.4.1. 设置独立MySQL数据库"></a>7.4.1. 设置独立MySQL数据库</h4><h5 id="7-4-1-1-临时启动Harbor服务用语导出MySQL表结构到独立的MySQL"><a href="#7-4-1-1-临时启动Harbor服务用语导出MySQL表结构到独立的MySQL" class="headerlink" title="7.4.1.1. 临时启动Harbor服务用语导出MySQL表结构到独立的MySQL"></a>7.4.1.1. 临时启动Harbor服务用语导出MySQL表结构到独立的MySQL</h5><pre><code class="line-numbers language-sh">cd /path/to/harbor
./install.sh
docker exec -it harbor-db  bash
mysql -uroot -proot123
mysqldump -uroot -proot123 --database registry &gt; registry.sql
</code></pre>
<h5 id="7-4-1-2-在独立MySQL中导入Harbor表结构并测试权限"><a href="#7-4-1-2-在独立MySQL中导入Harbor表结构并测试权限" class="headerlink" title="7.4.1.2. 在独立MySQL中导入Harbor表结构并测试权限"></a>7.4.1.2. 在独立MySQL中导入Harbor表结构并测试权限</h5><pre><code class="line-numbers language-sh">source registry.sql
GRANT ALL ON registry.* TO &#39;harbor&#39;@&#39;%&#39; IDENTIFIED BY &#39;harbor&#39;;
GRANT ALL ON registry.* TO &#39;harbor&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;harbor&#39;;
flush privileges;

#测试登录权限
mysql -uharbor -pharbor -h172.16.149.129 -D registry
</code></pre>
<h4 id="7-4-2-修改Harbor默认配置"><a href="#7-4-2-修改Harbor默认配置" class="headerlink" title="7.4.2. 修改Harbor默认配置"></a>7.4.2. 修改Harbor默认配置</h4><h5 id="7-4-2-1-修改Harbor存储位置"><a href="#7-4-2-1-修改Harbor存储位置" class="headerlink" title="7.4.2.1. 修改Harbor存储位置"></a>7.4.2.1. 修改Harbor存储位置</h5><p>默认情况下，harbor将数据volume挂载到主机的<code>/data</code>路径下面。但由于我们采用ceph共享存储保证数据的高可用，需要修改harbor组件内容器的挂载路径，将其mount到共享存储挂载node上的路径：<code>/mnt/harbor/data/</code>。我们需要修改docker-compose.yml和harbor.cfg两个文件。</p>
<ul>
<li>docker-compose.yml</li>
</ul>
<p>用正则批量处理替换挂载路径</p>
<pre><code class="line-numbers language-sh">cd /path/to/harbor
cp docker-compose.yml docker-compose.yml.bak
sed -i &#39;s/\/data\//\/mnt\/harbor\/data\//g&#39; docker-compose.yml
sed -i &#39;s/var\/log\/harbor/mnt\/harbor\/log/g&#39; docker-compose.yml
</code></pre>
<p>对比修改后的配置文件</p>
<pre><code class="line-numbers language-sh">$ diff docker-compose.yml docker-compose.yml.bak

8c8
&lt;       - /mnt/harbor/log/:/var/log/docker/:z
---
&gt;       - /var/log/harbor/:/var/log/docker/:z
18c18
&lt;       - /mnt/harbor/data/registry:/storage:z
---
&gt;       - /data/registry:/storage:z
38c38
&lt;       - /mnt/harbor/data/database:/var/lib/mysql:z
---
&gt;       - /data/database:/var/lib/mysql:z
57,59c57,59
&lt;       - /mnt/harbor/data/config/:/etc/adminserver/config/:z
&lt;       - /mnt/harbor/data/secretkey:/etc/adminserver/key:z
---
&gt;       - /data/config/:/etc/adminserver/config/:z
&gt;       - /data/secretkey:/etc/adminserver/key:z
78,80c78,80
&lt;       - /mnt/harbor/data/secretkey:/etc/ui/key:z
&lt;       - /mnt/harbor/data/ca_download/:/etc/ui/ca/:z
&lt;       - /mnt/harbor/data/psc/:/etc/ui/token/:z
---
&gt;       - /data/secretkey:/etc/ui/key:z
&gt;       - /data/ca_download/:/etc/ui/ca/:z
&gt;       - /data/psc/:/etc/ui/token/:z
99c99
&lt;       - /mnt/harbor/data/job_logs:/var/log/jobs:z
---
&gt;       - /data/job_logs:/var/log/jobs:z
101c101
&lt;       - /mnt/harbor/data/secretkey:/etc/jobservice/key:z
---
&gt;       - /data/secretkey:/etc/jobservice/key:z
</code></pre>
<p>由于不再需要harbor_db组件，把其从docker-compose.yml中删除<br>删除的包括这些：</p>
<pre><code>  mysql:
    image: vmware/harbor-db:v1.2.2
    container_name: harbor-db
    restart: always
    volumes:
      - /mnt/harbor/data/database:/var/lib/mysql:z
    networks:
      - harbor
    env_file:
      - ./common/config/db/env
    depends_on:
      - log
    logging:
      driver: &quot;syslog&quot;
      options:
        syslog-address: &quot;tcp://127.0.0.1:1514&quot;
        tag: &quot;mysql&quot;
</code></pre>
<p>注释掉proxy对MySQL的依赖</p>
<pre><code>    depends_on:
      #- mysql
      - registry
      - ui
      - log
</code></pre>
<blockquote>
<p>如果在Harbor页面中发现如下警告，请确认上述配置调整是否有落下<br><img src="/images/161921_88f9f072_381055.png" alt="输入图片说明" title="屏幕截图.png"></p>
</blockquote>
<ul>
<li>harbor.cfg</li>
</ul>
<p>修改harbor.cfg，修改后的对比如下</p>
<p>备份</p>
<pre><code>cp harbor.cfg  harbor.cfg.bak
</code></pre>
<pre><code class="line-numbers language-sh">$ diff harbor.cfg harbor.cfg.bak

24,25c24,25
&lt; ssl_cert = /mnt/harbor/data/cert/server.crt
&lt; ssl_cert_key = /mnt/harbor/data/cert/server.key
---
&gt; ssl_cert = /data/cert/server.crt
&gt; ssl_cert_key = /data/cert/server.key
28c28
&lt; secretkey_path = /mnt/harbor/data
---
&gt; secretkey_path = /data
...
#最后一行
&lt; RESET=true
---
&gt; RESET=false
</code></pre>
<blockquote>
<p>注意： 最后一行RESET&#x3D;true如果忘了修改，会报错：</p>
</blockquote>
<pre><code>==&gt; jobservice.log &lt;==
Dec 15 17:06:19 172.18.0.1 jobservice[21885]: 2017-12-15T09:06:19Z [ERROR] [utils.go:102]: failed to connect to tcp://mysql:3306, retry after 2 seconds :dial tcp: lookup mysql: Temporary failure in name resolution
==&gt; ui.log &lt;==
Dec 15 17:06:20 172.18.0.1 ui[21885]: 2017-12-15T09:06:20Z [ERROR] [utils.go:102]: failed to connect to tcp://mysql:3306, retry after 2 seconds :dial tcp: lookup mysql: Temporary failure in name resolution
</code></pre>
<h5 id="7-4-2-1-设置独立MySQL配置"><a href="#7-4-2-1-设置独立MySQL配置" class="headerlink" title="7.4.2.1. 设置独立MySQL配置"></a>7.4.2.1. 设置独立MySQL配置</h5><p>修改ui、jobservice两个组件的MySQL配置</p>
<pre><code class="line-numbers language-sh">$ cp common/templates/adminserver/env common/templates/adminserver/env.bak
$ diff  common/templates/adminserver/env common/templates/adminserver/env.bak

14c14
&lt; MYSQL_HOST=172.16.149.129
---
&gt; MYSQL_HOST=mysql
16,17c16,17
&lt; MYSQL_USR=harbor
&lt; MYSQL_PWD=harbor
---
&gt; MYSQL_USR=root
&gt; MYSQL_PWD=$db_password
</code></pre>
<blockquote>
<p>注意： 在ui和jobservice组件的独立目录下也有env配置，修改那个地方不生效，需修改adminserver下envzho的配置。</p>
</blockquote>
<p>到此为止，Harbor配置的本地存储改为共享存储，MySQL用独立MySQL了。</p>
<h4 id="7-4-3-测试Harbor共享存储"><a href="#7-4-3-测试Harbor共享存储" class="headerlink" title="7.4.3. 测试Harbor共享存储"></a>7.4.3. 测试Harbor共享存储</h4><ul>
<li>修改harbor配置并启动安装本机Harbor</li>
</ul>
<pre><code class="line-numbers language-sh">$ cat harbor.cfg
hostname = 172.16.1.144

$ ./install.sh
</code></pre>
<ul>
<li>安装更多Harbor节点</li>
</ul>
<p>为方便快速启动，拷贝本机<code>/path/to/harbor</code>目录到其他待安装的Harbor节点，执行以下步骤即可：</p>
<ol>
<li>升级内核到4.0+（如果本机内核版本比较低）</li>
<li>修改harbor.cfg中的hostname为本机IP</li>
<li>创建挂载点，并挂载CephFS到&#x2F;mnt&#x2F;harbor，确认可读写</li>
<li>安装Harbor服务</li>
</ol>
<p>Harbor节点安装完成后，任选一台节点进行变更操作，再登录另外一台Harbor可以看到同样的变化。 此时根据上述6.1节 Nginx安装部署的步骤把所有节点加入到负载均衡配置中。再使用负载均衡地址进行pull和push操作查看效果，至此，第二种基于共享存储的Harbor高可用集群已经搭建完成。</p>
<h2 id="8-参考文档"><a href="#8-参考文档" class="headerlink" title="8. 参考文档"></a>8. 参考文档</h2><p><a target="_blank" rel="noopener" href="https://github.com/vmware/harbor/blob/master/docs/installation_guide.md">https://github.com/vmware/harbor/blob/master/docs/installation_guide.md</a></p>
<p><a target="_blank" rel="noopener" href="http://docs.ceph.com/docs/master/rados/">http://docs.ceph.com/docs/master/rados/</a></p>
<p><a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html">http://nginx.org/en/docs/http/ngx_http_upstream_module.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tesun.net/centos7sheng-ji-nei-he/">https://www.tesun.net/centos7sheng-ji-nei-he/</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/signmem/article/details/78594340">http://blog.csdn.net/signmem/article/details/78594340</a></p>
<p><a target="_blank" rel="noopener" href="http://xiaqunfeng.cc/2017/09/15/too-many-PGs-per-OSD/">http://xiaqunfeng.cc/2017/09/15/too-many-PGs-per-OSD/</a></p>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2019/02/24/%E8%BF%90%E7%BB%B4/Jenkins%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  Jenkins集群部署文档
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2019/02/24/%E8%BF%90%E7%BB%B4/Rancher%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/">
                Rancher集群部署文档
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">MC</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>